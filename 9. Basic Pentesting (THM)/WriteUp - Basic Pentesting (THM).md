# 1) Introducción

En este conjunto de tareas aprenderás lo siguiente:

- fuerza bruta 
- craqueo de hachís 
- enumeración de servicios
- Enumeración de Linux

El objetivo principal es aprender todo lo posible.

# 2) Preguntas a contestar

## a) Implementar la máquina y conectarse a nuestra red

**Respuesta: No aplica.**
## b) Encuentra los servicios expuestos por la máquina

Realizamos un Nmap para listar los puertos abiertos y los servicios que corren en ellos.

```
nmap -sV -A -T4 10.10.221.111
```

![](IMG/Pasted%20image%2020250325001835.png)

**Respuesta: No aplica.**

Tenemos los siguientes puertos abiertos, con sus servicios correspondientes:

22/ssh
80/http
139/Samba
445/Samba
8009/ajp13?
8080/http

## c) ¿Cuál es el nombre del directorio oculto en el servidor web (ingrese el nombre sin /)?

Usamos dirbuster para listar los directorios de la web. Obtenemos una ruta hacia /development/ que al parecer tiene dos archivos en su interior.

![](IMG/Pasted%20image%2020250325002816.png)

**Respuesta: development**

No nos lo piden, pero por curiosidad, abriré los dos archivos del directorio /development

![](IMG/Pasted%20image%2020250325002947.png)

![](IMG/Pasted%20image%2020250325003012.png)

![](IMG/Pasted%20image%2020250325003054.png)

Parece ser una conversación entre los desarrolladores de la web, en la que hablan sobre que Samba y Apache están configurados y de lo fácil que es averiguar la contraseña. Lo tendremos en cuenta.

## d) Fuerza bruta del usuario para encontrar el nombre de usuario y la contraseña

**Respuesta: No aplica.**
## e) ¿Cual es el nombre de usuario?

Para averiguar el nombre de usuario, aprovechando que tenemos un servidor samba, usaremos enum4linux, para tratar de encontrar los usuarios registrados.

```
enum4linux -a 10.10.221.111
```

![](IMG/Pasted%20image%2020250325003746.png)

![](IMG/Pasted%20image%2020250325003826.png)

**Respuesta: jan**
## f) ¿Cual es la contraseña?

Aprovechando que tenemos SSH activo en el puerto 22, como vimos en Nmap, vamos a realizar un ataque de fuerza bruta con hydra, a ver si podemos conseguir la contraseña para el usuario jan. Usaremos el diccionario rockyou.

```
hydra -l jan -P /usr/share/wordlists/rockyou.txt 10.10.221.111 ssh
```

![](IMG/Pasted%20image%2020250325004712.png)

Hemos encontrado la contraseña.

**Respuesta: armando**
## g) ¿Qué servicio utilizas para acceder al servidor (responde en forma abreviada en mayúsculas)?

Pues ya que tenemos el usuario y la contraseña y podemos conectar por ssh...

```
ssh jan@10.10.221.111
```

![](IMG/Pasted%20image%2020250325005047.png)

**Respuesta: ssh**

## h) Enumere la máquina para encontrar cualquier vector de escalada de privilegios

Vemos que, evidentemente somos el usuario jan y que no tenemos privilegios suficientes, ya que tendríamos que ser root.

![](IMG/Pasted%20image%2020250325005633.png)

**Respuesta: No aplica.**

Para escalar privilegios, podemos usar uno de los scripts que existen para este caso, como pueden ser LinEnum, LinPeas o WinPeas. Vamos a probar con LinPeas que es el que según veo en los foros es el que mejor resultados da.

Podemos descargar linpeas.sh desde [Aquí](https://github.com/peass-ng/PEASS-ng/releases/tag/20250320-91fb36a0)

Una vez descargado, lo pasamos a la maquina objetivo usando ssh.

```
scp /Descargas/linpeas.sh jan@10.10.221.111:/dev/shm
```

![](IMG/Pasted%20image%2020250325011502.png)

Una vez copiado correctamente, le damos permisos:

```
chmod 777 /dev/shm/linpeas.sh
```

![](IMG/Pasted%20image%2020250325012045.png)
y lo ejecutamos (en ssh).

```
./dev/shm/linpeas.sh -w
```

usamos -w para que vaya parando entre ejecuciones y que no perdamos el texto.

![](IMG/Pasted%20image%2020250325012210.png)

Nos mostrará gran cantidad de información como credenciales, posibles vulnerabilidades, etc. En nuestro caso, nos muestra algo bastante interesante un certificado de clave privada rsa.

![](IMG/Pasted%20image%2020250325012550.png)

Lo copiamos y lo guardamos en un archivo que llamaremos kay_rsa (por ejemplo) en nuestra maquina atacante, para posteriormente tratar de averiguar la contraseña con john the ripper.

una vez tenemos nuestro archivo, usaremos ssh2john para que así le sea mas facil a john the ripper averiguar la contraseña mediante su hash.

```
ssh2john kay_rsa > password.hash
```

![](IMG/Pasted%20image%2020250325013617.png)

Una vez preparado el archivo, usamos john the ripper con el diccionario rockyou.

```
john --wordlist=/usr/share/wordlists/rockyou.txt password.hash
```

![](IMG/Pasted%20image%2020250325014909.png)

y encontramos la contraseña, beeswax

## i) ¿Cuál es el nombre del otro usuario que encontraste (todo en minúsculas)?

Como vimos antes...

**Respuesta: kay**

## j) Si has encontrado otro usuario, ¿qué puedes hacer con esta información?

Podríamos tratar de averiguar la contraseña del otro usuario y ver si tiene más privilegios que el que tenemos actualmente, o bien, encontrar mas información en los archivos de este usuario, ya que si vamos a su directorio home vemos que hay un archivo llamado pass.bak

![](IMG/Pasted%20image%2020250325010217.png)

## k) ¿Cuál es la contraseña final que obtienes?

Pues ahora, que ya tenemos las credenciales del otro usuario, accedemos a traves de ssh desde el ssh del usuario jan con ellas. Usaremos la opcion -i para usar la clave privada del usuario en la conexión.

```
ssh -i /home/kay/.ssh/id_rsa kay@10.10.221.111
```

![](IMG/Pasted%20image%2020250325015626.png)

Y ahora que ya tenemos acceso a los archivos del usuario kay, abrimos el archivo pass.bak, y veremos la contraseña.

![](IMG/Pasted%20image%2020250325015708.png)

**Respuesta: heresareallystrongpasswordthatfollowsthepasswordpolicy$$